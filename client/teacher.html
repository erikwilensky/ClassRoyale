<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Client</title>
    <script src="https://unpkg.com/colyseus.js@^0.15.0/dist/colyseus.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        input {
            padding: 8px;
            margin: 5px;
            width: 100%;
            box-sizing: border-box;
        }
        #questionInput {
            margin-bottom: 10px;
        }
        #durationInput {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Teacher Client</h1>
    
    <div>
        <button id="joinBtn">JOIN as teacher</button>
        <div id="status">Not connected</div>
    </div>

    <div id="gameControls" style="display: none; margin-top: 20px;">
        <h2>Start Round</h2>
        <input type="text" id="questionInput" placeholder="Enter question text">
        <input type="number" id="durationInput" placeholder="Duration in seconds" min="1" value="60">
        <button id="startRoundBtn">START ROUND</button>
    </div>

    <script>
        let room = null;
        const joinBtn = document.getElementById("joinBtn");
        const startRoundBtn = document.getElementById("startRoundBtn");
        const statusDiv = document.getElementById("status");
        const gameControls = document.getElementById("gameControls");
        const questionInput = document.getElementById("questionInput");
        const durationInput = document.getElementById("durationInput");

        joinBtn.addEventListener("click", async () => {
            try {
                const client = new Colyseus.Client("ws://localhost:3000");
                room = await client.joinOrCreate("quiz_room", { role: "teacher" });
                
                statusDiv.textContent = "Connected as teacher";
                joinBtn.disabled = true;
                gameControls.style.display = "block";

                room.onMessage("*", (type, message) => {
                    console.log("Received message:", type, message);
                });

                room.onStateChange((state) => {
                    console.log("State changed:", state);
                });

                room.onLeave(() => {
                    statusDiv.textContent = "Disconnected";
                    joinBtn.disabled = false;
                    gameControls.style.display = "none";
                });

            } catch (error) {
                console.error("Failed to join room:", error);
                statusDiv.textContent = "Error: " + error.message;
            }
        });

        startRoundBtn.addEventListener("click", () => {
            if (!room) {
                alert("Please join the room first");
                return;
            }

            const question = questionInput.value.trim();
            const duration = parseInt(durationInput.value);

            if (!question) {
                alert("Please enter a question");
                return;
            }

            if (!duration || duration <= 0) {
                alert("Please enter a valid duration");
                return;
            }

            room.send("startRound", {
                question: question,
                duration: duration
            });

            console.log("Sent startRound:", { question, duration });
        });
    </script>
</body>
</html>

